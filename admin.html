<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ê–¥–º–∏–Ω–∫–∞</title>

<style>
body{background:#020617;color:#e5e7eb;font-family:Arial;padding:14px}
h1{text-align:center}
input,textarea{width:100%;padding:12px;margin-top:10px;border-radius:8px;border:none}
button{width:100%;padding:12px;margin-top:8px;border-radius:8px;border:none;background:#38bdf8;font-weight:bold}
.group{background:#0f172a;padding:12px;border-radius:10px;margin-top:12px}
.row{display:flex;gap:6px;margin-top:6px}
.row button{flex:1}
.hidden{display:none}
</style>
</head>

<body>

<h1>–ê–¥–º–∏–Ω–∫–∞</h1>

<div id="loginBox">
  <input id="loginUser" placeholder="–õ–æ–≥–∏–Ω">
  <input id="loginPass" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
  <button onclick="login()">–í–æ–π—Ç–∏</button>
</div>

<div id="adminBox" class="hidden">

<textarea id="input" placeholder="–í—Å—Ç–∞–≤—å –Ω–æ–≤—ã–µ –Ω–æ–º–µ—Ä–∞"></textarea>
<button onclick="analyze()">–î–æ–±–∞–≤–∏—Ç—å / –Ω–∞–π—Ç–∏ –ø–∞—Ä—ã</button>

<div id="groups"></div>

<button onclick="saveToGitHub()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å (GitHub)</button>
<button onclick="logout()">–í—ã–π—Ç–∏</button>

</div>

<script>
/* ====== –ù–ê–°–¢–†–û–ô–ö–ò ====== */
const ADMINS={admin:"12345",jabrail:"2024"};

const GITHUB_TOKEN="–í–°–¢–ê–í–¨_–°–Æ–î–ê_TOKEN";
const OWNER="djabrail2332-creator";
const REPO="djabrail2332-creator.github.io";
const PATH="data.json";
/* ====================== */

let data=[];

/* üîê LOGIN */
function login(){
  if(ADMINS[loginUser.value]===loginPass.value){
    loginBox.classList.add("hidden");
    adminBox.classList.remove("hidden");
    load();
  } else alert("–ù–µ–≤–µ—Ä–Ω–æ");
}
function logout(){location.reload();}

/* üì• –ó–ê–ì–†–£–ó–ö–ê data.json */
async function load(){
  try{
    const r=await fetch(PATH);
    data=await r.json();
  }catch{ data=[]; }
  render();
}

/* ‚ûï –ê–ù–ê–õ–ò–ó */
function analyze(){
  const d=input.value.replace(/\D/g,"");
  if(!d) return;
  let raw=[];
  for(let i=0;i+10<d.length;i+=11) raw.push(d.substr(i,11));
  const phones=raw.map(p=>"+7"+(p.startsWith("8")?p.slice(1):p.slice(1)));

  const used=new Set();
  for(let i=0;i<phones.length;i++){
    if(used.has(i))continue;
    let g=[phones[i]];used.add(i);
    for(let j=i+1;j<phones.length;j++){
      if(!used.has(j)&&ham(phones[i],phones[j])===1){
        g.push(phones[j]);used.add(j);
      }
    }
    data.push({numbers:g,price:0,category:g.length>1?"gold":"simple",status:"active"});
  }
  input.value="";
  render();
}

/* üßæ UI */
function render(){
  groups.innerHTML="";
  data.forEach((g,i)=>{
    groups.innerHTML+=`
    <div class="group">
      <div>${g.numbers.join("<br>")}</div>
      <input type="number" placeholder="–¶–µ–Ω–∞" value="${g.price||""}"
        oninput="data[${i}].price=+this.value">
      <div class="row">
        <button onclick="data[${i}].status='active'">–í –Ω–∞–ª–∏—á–∏–∏</button>
        <button onclick="data[${i}].status='sold'">–ü—Ä–æ–¥–∞–Ω–æ</button>
        <button onclick="data.splice(${i},1);render()">–£–¥–∞–ª–∏—Ç—å</button>
      </div>
    </div>`;
  });
}

/* üíæ –°–û–•–†–ê–ù–ï–ù–ò–ï –í GITHUB */
async function saveToGitHub(){
  const api=`https://api.github.com/repos/${OWNER}/${REPO}/contents/${PATH}`;

  let sha=null;
  try{
    const r=await fetch(api,{headers:{Authorization:`token ${GITHUB_TOKEN}`}});
    if(r.ok){ const j=await r.json(); sha=j.sha; }
  }catch{}

  const body={
    message:"update data.json",
    content:btoa(unescape(encodeURIComponent(JSON.stringify(data,null,2)))),
    sha:sha
  };

  const res=await fetch(api,{
    method:"PUT",
    headers:{
      Authorization:`token ${GITHUB_TOKEN}`,
      "Content-Type":"application/json"
    },
    body:JSON.stringify(body)
  });

  if(res.ok) alert("‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ! –ü–æ–∫—É–ø–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ");
  else alert("‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è");
}

/* üìê –•–≠–ú–ú–ò–ù–ì */
function ham(a,b){let d=0;for(let i=0;i<a.length;i++)if(a[i]!=b[i])d++;return d;}
</script>

</body>
</html>
