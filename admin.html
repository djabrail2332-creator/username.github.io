<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ê–¥–º–∏–Ω–∫–∞</title>

<style>
body {
    background:#020617;
    color:#e5e7eb;
    font-family:Arial,sans-serif;
    padding:14px;
}
h1 { text-align:center; }

input, textarea {
    width:100%;
    padding:12px;
    margin-top:10px;
    border-radius:8px;
    border:none;
}

button {
    width:100%;
    padding:10px;
    margin-top:6px;
    border-radius:8px;
    border:none;
    background:#38bdf8;
    font-weight:bold;
    cursor:pointer;
}

.group {
    background:#0f172a;
    border-radius:10px;
    padding:12px;
    margin-top:12px;
}

.row {
    display:flex;
    gap:6px;
    margin-top:6px;
}

.row button {
    flex:1;
}

.hidden { display:none; }

.status-active { background:#22c55e; color:#020617; }
.status-sold { background:#ef4444; color:#fff; }
</style>
</head>

<body>

<h1>–ê–¥–º–∏–Ω–∫–∞</h1>

<!-- üîê LOGIN -->
<div id="loginBox">
    <input id="loginUser" placeholder="–õ–æ–≥–∏–Ω">
    <input id="loginPass" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
    <button onclick="login()">–í–æ–π—Ç–∏</button>
</div>

<!-- ‚öôÔ∏è ADMIN -->
<div id="adminBox" class="hidden">

<textarea id="input" placeholder="–í—Å—Ç–∞–≤—å –Ω–æ–≤—ã–µ –Ω–æ–º–µ—Ä–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></textarea>
<button onclick="analyze()">–î–æ–±–∞–≤–∏—Ç—å –∏ –Ω–∞–π—Ç–∏ –ø–∞—Ä—ã</button>

<div id="groups"></div>

<button onclick="save()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
<button onclick="logout()">–í—ã–π—Ç–∏</button>

</div>

<script>
/* üîê –ê–î–ú–ò–ù–´ */
const ADMINS = {
    admin: "12345",
    jabrail: "2024"
};

let result = [];

/* üîê LOGIN */
function login() {
    const u = loginUser.value.trim();
    const p = loginPass.value.trim();

    if (ADMINS[u] === p) {
        loginBox.classList.add("hidden");
        adminBox.classList.remove("hidden");
        sessionStorage.setItem("admin", "1");
        load();
    } else {
        alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å");
    }
}

if (sessionStorage.getItem("admin") === "1") {
    loginBox.classList.add("hidden");
    adminBox.classList.remove("hidden");
    load();
}

/* üö™ LOGOUT */
function logout() {
    sessionStorage.removeItem("admin");
    location.reload();
}

/* üì• –ó–ê–ì–†–£–ó–ö–ê –ò–ó –ë–ê–ó–´ */
function load() {
    result = JSON.parse(localStorage.getItem("SHOP_DATA") || "[]");
    render();
}

/* ‚ûï –ê–ù–ê–õ–ò–ó –ò –î–û–ë–ê–í–õ–ï–ù–ò–ï */
function analyze() {
    const text = input.value;
    if (!text.trim()) return;

    const digits = text.replace(/\D/g, "");
    let raw = [];
    for (let i = 0; i + 10 < digits.length; i += 11) {
        raw.push(digits.substr(i, 11));
    }

    const phones = raw.map(p => {
        if (p.startsWith("8")) p = "7" + p.slice(1);
        return "+7" + p.slice(1);
    });

    const used = new Set();

    for (let i = 0; i < phones.length; i++) {
        if (used.has(i)) continue;

        let group = [phones[i]];
        used.add(i);

        for (let j = i + 1; j < phones.length; j++) {
            if (!used.has(j) && hamming(phones[i], phones[j]) === 1) {
                group.push(phones[j]);
                used.add(j);
            }
        }

        result.push({
            numbers: group,
            price: 0,
            category: group.length > 1 ? "gold" : "simple",
            status: "active"
        });
    }

    input.value = "";
    render();
}

/* üßæ –†–ï–ù–î–ï–† */
function render() {
    groups.innerHTML = "";

    result.forEach((g, i) => {
        groups.innerHTML += `
        <div class="group">
            <div>${g.numbers.join("<br>")}</div>

            <input type="number" placeholder="–¶–µ–Ω–∞"
                value="${g.price || ""}"
                oninput="setPrice(${i}, this.value)">

            <div class="row">
                <button class="status-active" onclick="setStatus(${i}, 'active')">–í –Ω–∞–ª–∏—á–∏–∏</button>
                <button class="status-sold" onclick="setStatus(${i}, 'sold')">–ü—Ä–æ–¥–∞–Ω–æ</button>
                <button onclick="removeItem(${i})">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
        </div>`;
    });
}

/* ‚úèÔ∏è –ò–ó–ú–ï–ù–ï–ù–ò–Ø */
function setPrice(i, val) {
    result[i].price = Number(val);
}

function setStatus(i, status) {
    result[i].status = status;
    render();
}

function removeItem(i) {
    if (confirm("–£–¥–∞–ª–∏—Ç—å –Ω–æ–º–µ—Ä?")) {
        result.splice(i, 1);
        render();
    }
}

/* üíæ –°–û–•–†–ê–ù–ï–ù–ò–ï */
function save() {
    localStorage.setItem("SHOP_DATA", JSON.stringify(result));
    alert("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ");
}

/* üìê –•–≠–ú–ú–ò–ù–ì */
function hamming(a, b) {
    let d = 0;
    for (let i = 0; i < a.length; i++) {
        if (a[i] !== b[i]) d++;
    }
    return d;
}
</script>

</body>
</html>
