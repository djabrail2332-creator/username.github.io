<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ö—Ä–∞—Å–∏–≤—ã–µ —Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã–µ –Ω–æ–º–µ—Ä–∞</title>

<style>
body {
    margin: 0;
    font-family: system-ui, Arial, sans-serif;
    background: #0f172a;
    color: #e5e7eb;
    padding: 16px;
}
.container { max-width: 1000px; margin: auto; }
h1 { text-align: center; color: #38bdf8; }

.card {
    background: #020617;
    border-radius: 14px;
    padding: 16px;
    margin-top: 16px;
}

textarea {
    width: 100%;
    height: 140px;
    background: #020617;
    color: #e5e7eb;
    border: 1px solid #334155;
    border-radius: 10px;
    padding: 12px;
    font-size: 16px;
}

button {
    padding: 12px;
    border: none;
    border-radius: 10px;
    background: #38bdf8;
    color: #020617;
    font-size: 15px;
    font-weight: bold;
    cursor: pointer;
    margin-top: 10px;
    width: 100%;
}

.controls {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.number {
    background: #020617;
    padding: 12px;
    border-radius: 10px;
    margin-top: 8px;
    display: grid;
    grid-template-columns: 1fr auto auto auto auto;
    gap: 8px;
    align-items: center;
}

.gold { border: 2px solid #facc15; background: #1e293b; }
.silver { border: 1px solid #94a3b8; }
.simple { border: 1px solid #334155; }

.price { color: #4ade80; font-weight: bold; }
.score { color: #facc15; font-size: 13px; }
.pair { color: #38bdf8; font-size: 12px; }

.highlight span {
    color: #facc15;
    font-weight: bold;
}

label {
    font-size: 14px;
    color: #cbd5f5;
}
</style>
</head>

<body>
<div class="container">
<h1>–ö—Ä–∞—Å–∏–≤—ã–µ —Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã–µ –Ω–æ–º–µ—Ä–∞</h1>

<div class="card">
<textarea id="input" placeholder="
8928-735-79-89
8928-735-56-88
8828-735-05-25
8928-735-70-90
8928-735-60-90
"></textarea>

<div class="controls">
    <button onclick="analyze()">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å (–¥–æ 100)</button>
    <button onclick="exportCSV()">–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</button>
</div>

<label>
    <input type="checkbox" id="onlyPairs"> –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–∞—Ä–Ω—ã–µ
</label>
</div>

<div class="card" id="output"></div>
</div>

<script>
let exportData = [];

function analyze() {
    const text = document.getElementById("input").value;
    const onlyPairs = document.getElementById("onlyPairs").checked;

    const cleaned = text.replace(/[^\d]/g, " ");
    let matches = cleaned.match(/\d{10,11}/g);
    if (!matches) {
        document.getElementById("output").innerHTML = "–ù–æ–º–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã";
        return;
    }

    matches = matches.slice(0, 100);
    const phones = matches.map(normalize);

    const baseMap = {};
    phones.forEach(p => {
        const base = p.slice(0, -2);
        baseMap[base] = (baseMap[base] || 0) + 1;
    });

    let list = phones.map(num => {
        const score = calcScore(num, baseMap);
        const pair = baseMap[num.slice(0, -2)] > 1;
        const category = getCategory(score);
        return {
            num,
            score,
            pair,
            category,
            price: 1000 + score * 250
        };
    });

    if (onlyPairs) {
        list = list.filter(i => i.pair);
    }

    list.sort((a, b) => b.score - a.score);
    exportData = list;

    let html = "<h2>–†–µ–∑—É–ª—å—Ç–∞—Ç</h2>";

    list.forEach(item => {
        html += `
        <div class="number ${item.category}">
            <div class="highlight">${highlight(item.num)}</div>
            <div class="score">‚≠ê ${item.score}</div>
            <div>${item.category.toUpperCase()}</div>
            <div class="price">${item.price.toLocaleString()} ‚ÇΩ</div>
            ${item.pair ? "<div class='pair'>üîÅ –ø–∞—Ä–Ω—ã–π</div>" : ""}
        </div>`;
    });

    document.getElementById("output").innerHTML = html;
}

function normalize(n) {
    if (n.length === 10) n = "7" + n;
    if (n.startsWith("8")) n = "7" + n.slice(1);
    return "+7" + n.slice(1);
}

function getCategory(score) {
    if (score >= 150) return "gold";
    if (score >= 80) return "silver";
    if (score >= 40) return "simple";
    return "simple";
}

function calcScore(num, baseMap) {
    const n = num.slice(2);
    let score = 0;

    const last4 = n.slice(-4);
    const a = last4.slice(0,2);
    const b = last4.slice(2,4);

    if (/^(\d)\1+$/.test(n)) score += 120;
    if (/(\d)\1{3}$/.test(n)) score += 100;
    if (n === n.split("").reverse().join("")) score += 80;

    if (a[1] === b[1]) score += 50;
    if (b[0] === b[1]) score += 50;
    if (a === b.split("").reverse().join("")) score += 60;

    if (baseMap[num.slice(0, -2)] > 1) score += 70;

    const freq = {};
    n.split("").forEach(d => freq[d] = (freq[d] || 0) + 1);
    Object.values(freq).forEach(v => {
        if (v > 2) score += 10;
    });

    return score;
}

function highlight(num) {
    const n = num.slice(2);
    const freq = {};
    n.split("").forEach(d => freq[d] = (freq[d] || 0) + 1);

    return "+7" + n.split("").map(d =>
        freq[d] > 1 ? `<span>${d}</span>` : d
    ).join("");
}

function exportCSV() {
    if (!exportData.length) return alert("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");

    let csv = "–ù–æ–º–µ—Ä,–ö–∞—Ç–µ–≥–æ—Ä–∏—è,Score,–¶–µ–Ω–∞,–ü–∞—Ä–Ω—ã–π\n";
    exportData.forEach(r => {
        csv += `${r.num},${r.category},${r.score},${r.price},${r.pair ? "–¥–∞" : "–Ω–µ—Ç"}\n`;
    });

    const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "beautiful_numbers.csv";
    link.click();
}
</script>

</body>
</html>
